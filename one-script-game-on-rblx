--Project: Game with ONE Script.
--Game script.
--Made by sok2176.
--This is carting game on Roblox
--===========--
--|VARIABLES|--
--===========--

local timeForStart = 10
local timer = Instance.new("IntValue")
local checkpointer = Instance.new("IntValue")
local reward = math.random(467, 543)
local bp = game.Workspace.BlueCart
local bc = game.Workspace.BlackCart
local gc = game.Workspace.GreenCart
local yc = game.Workspace.YellowCart
local rc = game.Workspace.RedCart
local plars = game.Players
local stat = Instance.new("IntValue")
local statStorage = Instance.new("Folder")
local datastore = game:GetService("DataStoreService")
local WinsSave = datastore:GetDataStore("WinsSave")

--=============--
--|CHECKPOINTS|--
--=============--
game.Workspace.Start.Door.Touched:Connect(function(hit)
	if hit.Name == "HumanoidRootPart" then
		checkpointer.Value = 1
		checkpointer.Parent = hit.Parent
		checkpointer.Name = "Checkpoints"
	end
end)

game.Workspace.Checkpoint.Door.Touched:Connect(function(hit2)
	local ffc = hit2.Parent:FindFirstChild("Checkpoints")
	if hit2.Name == "HumanoidRootPart" then
		if ffc then
			ffc.Value = ffc.Value + 1
		end
	end
end)

game.Workspace.Checkpoint2.Door.Touched:Connect(function(hit2)
	local ffc = hit2.Parent:FindFirstChild("Checkpoints")
	if hit2.Name == "HumanoidRootPart" then
		if ffc then
			ffc.Value = ffc.Value + 1
		end
	end
end)

game.Workspace.Checkpoint3.Door.Touched:Connect(function(hit2)
	local ffc = hit2.Parent:FindFirstChild("Checkpoints")
	if hit2.Name == "HumanoidRootPart" then
		if ffc then
			ffc.Value = ffc.Value + 1
		end
	end
end)

game.Workspace.Checkpoint4.Door.Touched:Connect(function(hit2)
	local ffc = hit2.Parent:FindFirstChild("Checkpoints")
	if hit2.Name == "HumanoidRootPart" then
		if ffc then
			ffc.Value = ffc.Value + 1
		end
	end
end)

game.Workspace.Checkpoint5.Door.Touched:Connect(function(hit2)
	local ffc = hit2.Parent:FindFirstChild("Checkpoints")
	if hit2.Name == "HumanoidRootPart" then
		if ffc then
			ffc.Value = ffc.Value + 1
		end
	end
end)

game.Workspace.Checkpoint6.Door.Touched:Connect(function(hit2)
	local ffc = hit2.Parent:FindFirstChild("Checkpoints")
	if hit2.Name == "HumanoidRootPart" then
		if ffc then
			ffc.Value = ffc.Value + 1
		end
	end
end)

game.Workspace.Finish.Door.Touched:Connect(function(hit3)
	if hit3.Name == "HumanoidRootPart" then
		local ffc2 = hit3.Parent:FindFirstChild("Checkpoints")
		if ffc2 then
			if ffc2.Value == 7 then
				local winner = Instance.new("Hint")
				winner.Parent = workspace
				winner.Name = "IsWinner"
				winner.Text = ffc2.Parent.Name.." won the Race! Race over."
				local plr = game.Players:GetPlayerFromCharacter(ffc2.Parent)
				plr.leaderstats.Wins.Value =  plr.leaderstats.Wins.Value + reward
				wait(4)
				winner:Destroy()
				
			end
		end
	end
end)

bp.Head.click.MouseClick:Connect(function(plr)
	local car = script.Car.Value:Clone()
	car.Parent = workspace
	script.Parent.MaxActivationDistance = 0
	wait(7)
	script.Parent.MaxActivationDistance = 20

end)

bc.Head.click.MouseClick:Connect(function(plr)
	local car = script.Car2.Value:Clone()
	car.Parent = workspace
	script.Parent.MaxActivationDistance = 0
	wait(7)
	script.Parent.MaxActivationDistance = 20

end)

yc.Head.click.MouseClick:Connect(function(plr)
	local car = script.Car3.Value:Clone()
	car.Parent = workspace
	script.Parent.MaxActivationDistance = 0
	wait(7)
	script.Parent.MaxActivationDistance = 20

end)

rc.Head.click.MouseClick:Connect(function(plr)
	local car = script.Car4.Value:Clone()
	car.Parent = workspace
	script.Parent.MaxActivationDistance = 0
	wait(7)
	script.Parent.MaxActivationDistance = 20

end)

gc.Head.click.MouseClick:Connect(function(plr)
	local car = script.Car5.Value:Clone()
	car.Parent = workspace
	script.Parent.MaxActivationDistance = 0
	wait(7)
	script.Parent.MaxActivationDistance = 20

end)

plars.PlayerAdded:Connect(function(plr)
	statStorage.Name = "leaderstats"
	statStorage.Parent = plr
	stat.Value = 0
	stat.Parent = statStorage
	stat.Name = "Wins"

end)
--======--
--|RACE|--
--======--
while true do
	wait(20)
	local startMsg = Instance.new("Hint")
	startMsg.Parent = workspace
	for i = 1, 10 do
		wait(1)
		timeForStart = timeForStart - 1
		startMsg.Text = "Race Starts in "..tostring(timeForStart).." seconds!"
		if startMsg.Text == "Race Starts in 0 seconds!" then
			startMsg.Text = "Race Started!"
			wait(1)
			startMsg:Destroy()
			game.Workspace.Start.Protector.CanCollide = false
			timeForStart = timeForStart + 10
		end
	end
	wait(60.1)
	checkpointer.Value = 1
	game.Workspace.Start.Protector.CanCollide = true
end
	
